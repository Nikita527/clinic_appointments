Сценарий работы Telegram-бота для записи к врачу с ИИ-подбором
1. Старт и первичная регистрация

    Пациент запускает бота командой /start.
    Бот приветствует пользователя и объясняет, что поможет подобрать врача и записаться на приём.
    Бот просит ввести первичную информацию о себе:
        - Имя
        - Фамилия
        - Электронная почта
        - (Опционально: номер телефона)
    Бот отправляет эти данные в API (POST /api/v1/auth/register или аналогичный эндпоинт).
        - Если пользователь уже есть — бот сообщает об этом и предлагает войти (или продолжить).
    После успешной регистрации бот сообщает:
    «Спасибо, вы зарегистрированы! Теперь я помогу подобрать врача и записаться на приём.»

2. Сбор симптомов и подбор специализации

    Бот спрашивает:
    «Опишите, пожалуйста, вашу проблему или выберите специализацию врача из списка (например, терапевт, дерматолог, кардиолог и т.д.).»
    Пациент отвечает текстом (например, "болит горло", "высыпания на коже") или выбирает специализацию из кнопок.
    Бот отправляет текст в LLM/ML-модель (например, через n8n workflow, который вызывает внешнюю LLM или классификатор).
        - LLM определяет специализацию врача (например, "дерматолог").
        - Если специализация не определена — бот уточняет у пользователя.

3. Поиск врача и свободного времени

    - Бот запрашивает у API список врачей по выбранной специализации (GET /api/v1/doctors?specialization=...).
    - Бот предлагает пользователю выбрать врача (если их несколько) или сразу переходит к выбору времени.
    - Бот запрашивает у API свободные слоты для выбранного врача (GET /api/v1/appointments?doctor_id=...&free=true или аналогичный эндпоинт).
    - Бот предлагает пользователю выбрать удобное время из списка ближайших свободных слотов.

4. Подтверждение и создание записи

    Пациент выбирает время.
    Бот отправляет запрос на создание записи (POST /api/v1/appointments) с параметрами: user_id, doctor_id, start_time, end_time.
    Если запись успешна — бот сообщает:
        - «Вы успешно записаны к врачу [ФИО, специализация] на [дата, время].»
        - «Я напомню вам о визите за день и за час до приёма.»

5. Напоминания о визите

    Бот автоматически отправляет напоминания:
        - За 1 день до визита (например, в 9:00 утра).
        - За 1 час до визита.
    Для этого бот периодически проверяет записи в базе (или получает события через webhook/n8n) и отправляет сообщения тем, у кого скоро приём.

6. Дополнительные сценарии (на будущее)

    - Отмена или перенос записи:
    Пациент может отменить или изменить запись через бота.
    - История записей:
    Пациент может запросить список своих будущих и прошлых визитов.
    - Обратная связь:
    После визита бот может предложить оставить отзыв о враче.

7. Используемые технологии

    - ИИ/ML для подбора врача:
        Взаимодействие с LLM через n8n (например, OpenAI GPT-4, YandexGPT, HuggingFace, либо внутренний классификатор).
    - API микросервиса:
        Регистрация пользователя: POST /api/v1/auth/register
        Получение списка врачей: GET /api/v1/doctors
        Получение свободных слотов: GET /api/v1/appointments
        Создание записи: POST /api/v1/appointments
    - Отправка напоминаний:
        Через планировщик задач (например, Celery, APScheduler, либо через n8n workflow).

8. Пример диалога

Пациент: /start
Бот: Здравствуйте! Я помогу вам записаться к врачу. Для начала, пожалуйста, представьтесь: укажите имя, фамилию и электронную почту.
Пациент: Иван Иванов, ivan@example.com
Бот: Спасибо, вы зарегистрированы! Опишите, пожалуйста, вашу проблему или выберите специализацию врача.
Пациент: У меня высыпания на коже.
Бот (ИИ): Вам нужен дерматолог. Вот доступные врачи: [список]. Кого выберете?
Пациент: Иванова Ольга Петровна
Бот: Вот ближайшие свободные слоты: завтра в 12:00, завтра в 15:30, послезавтра в 10:00.
Пациент: Завтра в 12:00.
Бот: Вы успешно записаны к врачу Ивановой О.П., дерматологу, на завтра в 12:00. Я напомню вам о визите за день и за час до приёма.

9. Stub-структура для bot.py


# bot.py (примерная структура)
```bash
from aiogram import Bot, Dispatcher, types


async def handle_start(message: types.Message):
    # Запросить имя, фамилию, email
    # Зарегистрировать пользователя через API


async def handle_symptoms(message: types.Message):
    # Отправить текст в LLM через n8n, получить специализацию
    # Запросить у API список врачей и свободное время
    # Предложить пользователю варианты


async def handle_appointment_choice(message: types.Message):
    # Создать запись через API
    # Подтвердить запись и сообщить о напоминаниях


# ... и так далее
```
